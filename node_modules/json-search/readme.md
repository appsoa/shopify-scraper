#AmbassadorJS JSON.search

Search JSON using regex

[![Build Status][travis-image]][travis-url] [![Coverage Status][coveralls-image]][coveralls-url]

![Ambassador IO Logo](https://raw.githubusercontent.com/mgwhitfield/AmbassadorJSONSearch/master/logo-icon-64.PNG)

Search JSON using regex, up to 5x faster than $.grep and iterative search.  Works on the server and the client.  Used by [Spiritway](http://spiritway.co/).

***Syntax:*** `JSON.search(object, regex)`

***Result Format:*** `[{key,val,chain,inKey},...]`

## Installation

Use `require('json-search');` on the server and in the client, rename and/or include index.js into your page using `<script src="index.js"></script>`

## Performance

Generally, it's not a good idea to search JSON files over 1mb and it is not a good idea to search generic strings that will produce thousands of results.  In future releases, arbitrarily large JSON can be searched over distributed networks using Web Workers and API's.

See [http://jsperf.com/regex-on-large-strings](http://jsperf.com/regex-on-large-strings) for regex vs. iteration (up to 5x faster)

See [http://jsperf.com/json-search](http://jsperf.com/json-search) for $.grep vs. JSON.search (up to 3x faster)

## Description of Algorithm

First, stringify the JSON object. Then, you need to store the starts and lengths of the matched substrings. For example:
```
	"matched".search("ch") // yields 3
```

For a JSON string, this works exactly the same (unless you are searching explicitly for commas and curly brackets in which case I'd recommend some prior transform of your JSON object before performing regex (i.e. think `:, {, }`).

Next, you need to reconstruct the JSON object. The algorithm I authored does this by detecting JSON syntax by recursively going backwards from the match index. For instance, the pseudo code might look as follows:
```
	find the next key preceding the match index, call this theKey
	then find the number of all occurrences of this key preceding theKey, call this theNumber
	using the number of occurrences of all keys with same name as theKey up to position of theKey, traverse the object until keys named theKey has been discovered theNumber times
	return this object called parentChain
```

With this information, it is possible to use regex to filter a JSON object to return the key, the value, and the parent object chain.

## Coming soon

* stream results for large objects using Web Workers
* delegate searches to Spiritway API

## Contribute
 
To contribute, Tweet me [@mgwiship](http://twitter.com/mgwiship).  Our collaborators often become our employees, send an email to hello@spiritway.co with "collaborate" in the subject line.

[travis-image]: https://travis-ci.org/spiritway/json.search.png?branch=master
[travis-url]: https://travis-ci.org/spiritway/json.search

[coveralls-image]: https://coveralls.io/repos/spiritway/json.search/badge.svg
[coveralls-url]: https://coveralls.io/repos/spiritway/json.search/badge.svg

